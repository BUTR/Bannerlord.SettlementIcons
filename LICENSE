Code taken and ported from https://www.nexusmods.com/mountandblade2bannerlord/mods/429